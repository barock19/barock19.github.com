
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Rock</title>
	<meta name="author" content="Zidni Mubarock">

	
	<meta name="description" content="class ApplicationController &lt; ActionController::Base around_filter :_controller_for_model .... protected def _controller_for_model accessor = &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Rock" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">~ rock$</a></h1>
<br/>
<p>Yeahh .. I'm Rock'.</p>


</header>
	<div id="content" class="inner">


    <article class="post">
	<h1 class="title"><a href="/blog/2012/10/19/session-request-params-ada-di-model-ok-or-break-the-mvc-concept/">Session, Request, Params Ada Di Model. OK or Break the MVC Concept</a></h1>
	<div class="entry-content">
		<pre><code>class ApplicationController &lt; ActionController::Base
    around_filter :_controller_for_model

    ....

    protected
    def _controller_for_model
      accessor = instance_variable_get(:@_request)
      kelasess = [ActiveRecord::Base, ActiveRecord::Base.class]

      kelasess.each do |kelas|
        kelas.send(:define_method, "controller", proc {accessor})
      end
      yield
      kelasess.each do |kelas|
        kelas.send :remove_method, "controller"
      end

    end
end
</code></pre>

<p>klo lo modif ApplicationController kaya diatas, Model lo bakal punya method controller yang bisa punya isinya session, request dan params</p>

<p>MVC, Model View Controller. adalah sebuah concept yang ngebantu developer, memisahkan antara logic, design dan Representasi data storage. konsep ini keren bgt, apalagi kalo applikasi yang dikembangkan oleh team yang masing-masing udah punya job desc-nya sendiri - sendiri. Yang designer, urusannya di View, Programmer di Controller dan Model.</p>

<p>Tapi terkadang, buat orang males kaya gue. suka nemuin case (mungkin lo juga sering nemuin). contoh :</p>

<p>ada Model User, dan Post. Keduanya saling berelasi</p>

<pre><code>#model User
class User &lt; ActiveRecord::Base 
    has_many :posts
end
#model Post
class Post &lt; ActiveRecord::Base 
    belongs_to :user
end
</code></pre>

<p>session yang merepresentasi kan user yang sudah login udah ada misal, di sebuah Controller kita dah definisikan ini</p>

<pre><code>class UserController &lt; ApplicationController
    def auth
        user = User.where({:user_name =&gt; params[:user], :password =&gt; params[:password]})
        if !user.nil?
            session[:current_user_id] = user.id
        else
            #FTW, Lupa cuyy ??
            redirect_to request.referer
        end
    end
    ....
end
</code></pre>

<p>(Anggep aja, males nulis code nya) kita sudah punya resource Posts. ketika user mau bikin post baru, masalahnya muncul. Mana yang lo pilih, Lo mendefnisikan user(yang udah login) yang belongs_to post lewat resource PostsController</p>

<pre><code>#dalam PostController
def create
  @post = post.new(params[:post])
@post.user =  User.find(session[:current_user_id])
  respond_to do |format|
    ....
  end
end
</code></pre>

<p>atau lo detect di Post (model) pake callback?</p>

<pre><code>#dalam model Post
before_save :detect_current_user
def detect_current_user
    user = User.find(controller.session[:current_user_id]) unless session[:current_user_id].nil?
end
#note, method controller ada klo ApplicationController dah di modif kaya snippet yang paling atas
</code></pre>

<p>ini contoh sederhana aja. mungkin lo juga sering nemuin case yang lebih complex lagi yang membuat model harus bisa punya method request, sesssion, params langsung didalam model itu sendiri. tanpa harus passing argument ke model itu lewat controller</p>

		
		
	</div>


<div class="meta">
	
</div></article>


    <article class="post">
	<h1 class="title"><a href="/blog/2012/10/19/first-post/">First Post</a></h1>
	<div class="entry-content">
		<p>Hollaaa &#8230;</p>

		
		
	</div>


<div class="meta">
	
</div></article>

<nav id="pagenavi">
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<!-- 
		
<div id="banner" class="inner">
	<div class="container">
		<ul class="feed"></ul>
	</div>
	<small><a href="http://twitter.com/barock19">barock19</a> @ <a href="http://twitter.com">Twitter</a></small>
	<div class="loading">Loading...</div>
</div>
<script src="/javascripts/twitter.js"></script>
<script type="text/javascript">
	(function($){
		$('#banner').getTwitterFeed('barock19', 4, false);
	})(jQuery);
</script>

	 -->
	<footer id="footer" class="inner">Copyright &copy; 2012

    Zidni Mubarock

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'barock19';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





</body>
</html>